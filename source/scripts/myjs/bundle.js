/// <reference path="./defs/three/three.d.ts" />
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var GameObjects;
(function (GameObjects) {
    var Game = (function () {
        function Game(CANNON, THREE) {
            this.CANNON = CANNON;
            this.THREE = THREE;
            //init renderer
            this.renderer = new THREE.WebGLRenderer();
            this.renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(this.renderer.domElement);
            //init physics world
            this.world = new CANNON.World();
            this.world.gravity.set(0, 0, -9.82); // m/sÂ²
            console.log("new world created");
            console.log("new Game created");
        }
        Game.prototype.render = function (scene) {
            this.renderer.render(scene.threeScene, scene.camera);
        };
        return Game;
    })();
    GameObjects.Game = Game;
    //an item in the game.  meant to be a superclass for actual game objects
    var GameItem = (function () {
        function GameItem() {
            this.gameObjectID = GameItem.gameItemID;
            //store this gameObject in an array for later
            GameItem.gameItems[this.gameObjectID] = this;
            console.log("Object " + GameItem.gameItemID + " created.");
            GameItem.gameItemID++;
        }
        GameItem.prototype.getItem = function (id) {
            return GameItem.gameItems[id];
        };
        GameItem.gameItemID = 0;
        GameItem.gameItems = [];
        return GameItem;
    })();
    GameObjects.GameItem = GameItem;
    var Box = (function (_super) {
        __extends(Box, _super);
        function Box() {
            _super.call(this);
            this.geometry = new THREE.BoxGeometry(1, 1, 1);
            ;
            this.material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
            ;
            this.mesh = new THREE.Mesh(this.geometry, this.material);
            ;
        }
        Box.prototype.rotate = function (x, y, z) {
            if (x)
                this.mesh.rotation.x += x;
            if (y)
                this.mesh.rotation.y += y;
            if (z)
                this.mesh.rotation.z += z;
        };
        return Box;
    })(GameItem);
    GameObjects.Box = Box;
})(GameObjects || (GameObjects = {}));

/// <reference path="./defs/underscore/underscore.d.ts" />
/// <reference path="./defs/jquery/jquery.d.ts" />
/// <reference path="./defs/three/three.d.ts" />
/// <reference path="./gameObjects.ts" />
var $ = require("jquery");
var THREE = require("three");
var CANNON = require("cannon");
var game;
$(function () {
    console.log("jquery & underscore loaded");
    createGame();
});
function createGame() {
    game = new GameObjects.Game(CANNON, THREE);
    var scene = new GameScenes.Scene(THREE);
    var box = new GameObjects.Box();
    scene.add(box);
    scene.positionCamera(null, null, 5);
    var render = function () {
        requestAnimationFrame(render);
        box.rotate(.1, null, null);
        box.rotate(null, .1, null);
        game.render(scene);
    };
    render();
}

/// <reference path="./defs/three/three.d.ts" />
var GameScenes;
(function (GameScenes) {
    //a game scene.  It will have the camera, lights, and scene graph
    var Scene = (function () {
        function Scene(THREE, name) {
            this.lights = [];
            this.THREE = THREE;
            if (name) {
                this.name = name;
            }
            this.threeScene = new THREE.Scene();
            this.camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            console.log("scene " + Scene.sceneID + " created");
            Scene.scenes.push(this);
            Scene.sceneID++;
        }
        Scene.prototype.add = function (item) {
            this.threeScene.add(item.mesh);
        };
        Scene.prototype.positionCamera = function (x, y, z) {
            if (x)
                this.camera.position.x = x;
            if (y)
                this.camera.position.y = y;
            if (z)
                this.camera.position.z = z;
        };
        Scene.sceneID = 0;
        Scene.scenes = [];
        return Scene;
    })();
    GameScenes.Scene = Scene;
})(GameScenes || (GameScenes = {}));

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdhbWVPYmplY3RzLnRzIiwiYXBwLnRzIiwiZ2FtZVNjZW5lcy50cyJdLCJuYW1lcyI6WyJHYW1lT2JqZWN0cyIsIkdhbWVPYmplY3RzLkdhbWUiLCJHYW1lT2JqZWN0cy5HYW1lLmNvbnN0cnVjdG9yIiwiR2FtZU9iamVjdHMuR2FtZS5yZW5kZXIiLCJHYW1lT2JqZWN0cy5HYW1lSXRlbSIsIkdhbWVPYmplY3RzLkdhbWVJdGVtLmNvbnN0cnVjdG9yIiwiR2FtZU9iamVjdHMuR2FtZUl0ZW0uZ2V0SXRlbSIsIkdhbWVPYmplY3RzLkJveCIsIkdhbWVPYmplY3RzLkJveC5jb25zdHJ1Y3RvciIsIkdhbWVPYmplY3RzLkJveC5yb3RhdGUiLCJjcmVhdGVHYW1lIiwiR2FtZVNjZW5lcyIsIkdhbWVTY2VuZXMuU2NlbmUiLCJHYW1lU2NlbmVzLlNjZW5lLmNvbnN0cnVjdG9yIiwiR2FtZVNjZW5lcy5TY2VuZS5hZGQiLCJHYW1lU2NlbmVzLlNjZW5lLnBvc2l0aW9uQ2FtZXJhIl0sIm1hcHBpbmdzIjoiQUFBQSxnREFBZ0Q7Ozs7OztBQUloRCxJQUFPLFdBQVcsQ0F5RWpCO0FBekVELFdBQU8sV0FBVyxFQUFBLENBQUM7SUFFZkE7UUFRSUMsY0FBWUEsTUFBTUEsRUFBRUEsS0FBS0E7WUFDckJDLElBQUlBLENBQUNBLE1BQU1BLEdBQUdBLE1BQU1BLENBQUNBO1lBQ3JCQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxLQUFLQSxDQUFDQTtZQUNuQkEsZUFBZUE7WUFDZkEsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsSUFBSUEsS0FBS0EsQ0FBQ0EsYUFBYUEsRUFBRUEsQ0FBQ0E7WUFDMUNBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLE9BQU9BLENBQUVBLE1BQU1BLENBQUNBLFVBQVVBLEVBQUVBLE1BQU1BLENBQUNBLFdBQVdBLENBQUVBLENBQUNBO1lBQ3ZFQSxRQUFRQSxDQUFDQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFFQSxJQUFJQSxDQUFDQSxRQUFRQSxD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RCxtQkFBR0EsR0FBSEEsVUFBSUEsSUFBSUE7WUFDSkUsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDbkNBLENBQUNBO1FBRURGLDhCQUFjQSxHQUFkQSxVQUFlQSxDQUFTQSxFQUFFQSxDQUFTQSxFQUFFQSxDQUFTQTtZQUMxQ0csRUFBRUEsQ0FBQUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ0RBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1lBQy9CQSxFQUFFQSxDQUFBQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDREEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFDL0JBLEVBQUVBLENBQUFBLENBQUNBLENBQUNBLENBQUNBO2dCQUNEQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUNuQ0EsQ0FBQ0E7UUE5Qk1ILGFBQU9BLEdBQVdBLENBQUNBLENBQUNBO1FBQ3BCQSxZQUFNQSxHQUFHQSxFQUFFQSxDQUFDQTtRQThCdkJBLFlBQUNBO0lBQURBLENBcENBRCxBQW9DQ0MsSUFBQUQ7SUFwQ1lBLGdCQUFLQSxRQW9DakJBLENBQUFBO0FBRUxBLENBQUNBLEVBekNNLFVBQVUsS0FBVixVQUFVLFFBeUNoQiIsImZpbGUiOiJidW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi9kZWZzL3RocmVlL3RocmVlLmQudHNcIiAvPlxyXG5cclxuXHJcblxyXG5tb2R1bGUgR2FtZU9iamVjdHN7XHJcbiAgICBcclxuICAgIGV4cG9ydCBjbGFzcyBHYW1le1xyXG4gICAgICAgIG5hbWU6IHN0cmluZztcclxuICAgICAgICBzdGF0ZTogc3RyaW5nO1xyXG4gICAgICAgIHJlbmRlcmVyO1xyXG4gICAgICAgIHdvcmxkOyAgLy90aGUgcGh5c2ljcyB3b3JsZFxyXG4gICAgICAgIENBTk5PTjtcclxuICAgICAgICBUSFJFRTtcclxuXHJcbiAgICAgICAgY29uc3RydWN0b3IoQ0FOTk9OLCBUSFJFRSl7XHJcbiAgICAgICAgICAgIHRoaXMuQ0FOTk9OID0gQ0FOTk9OO1xyXG4gICAgICAgICAgICB0aGlzLlRIUkVFID0gVEhSRUU7XHJcbiAgICAgICAgICAgIC8vaW5pdCByZW5kZXJlclxyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyID0gbmV3IFRIUkVFLldlYkdMUmVuZGVyZXIoKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTaXplKCB3aW5kb3cuaW5uZXJXaWR0aCwgd2luZG93LmlubmVySGVpZ2h0ICk7XHJcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKCB0aGlzLnJlbmRlcmVyLmRvbUVsZW1lbnQgKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vaW5pdCBwaHlzaWNzIHdvcmxkXHJcbiAgICAgICAgICAgIHRoaXMud29ybGQgPSBuZXcgQ0FOTk9OLldvcmxkKCk7XHJcbiAgICAgICAgICAgIHRoaXMud29ybGQuZ3Jhdml0eS5zZXQoMCwgMCwgLTkuODIpOyAvLyBtL3PCslxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIm5ldyB3b3JsZCBjcmVhdGVkXCIpO1xyXG4gICAgXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwibmV3IEdhbWUgY3JlYXRlZFwiKTtcclxuICAgICAgICB9ICBcclxuICAgICAgICBcclxuICAgICAgICByZW5kZXIoc2NlbmUpe1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnJlbmRlcihzY2VuZS50aHJlZVNjZW5lLCBzY2VuZS5jYW1lcmEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgLy9hbiBpdGVtIGluIHRoZSBnYW1lLiAgbWVhbnQgdG8gYmUgYSBzdXBlcmNsYXNzIGZvciBhY3R1YWwgZ2FtZSBvYmplY3RzXHJcbiAgICBleHBvcnQgY2xhc3MgR2FtZUl0ZW17XHJcbiAgICAgICAgc3RhdGljIGdhbWVJdGVtSUQ6IG51bWJlciA9IDA7XHJcbiAgICAgICAgc3RhdGljIGdhbWVJdGVtcyA9IFtdO1xyXG4gICAgICAgIGdhbWVPYmplY3RJRDogbnVtYmVyO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGNvbnN0cnVjdG9yKCl7XHJcbiAgICAgICAgICAgIHRoaXMuZ2FtZU9iamVjdElEID0gR2FtZUl0ZW0uZ2FtZUl0ZW1JRDtcclxuXHJcbiAgICAgICAgICAgIC8vc3RvcmUgdGhpcyBnYW1lT2JqZWN0IGluIGFuIGFycmF5IGZvciBsYXRlclxyXG4gICAgICAgICAgICBHYW1lSXRlbS5nYW1lSXRlbXNbdGhpcy5nYW1lT2JqZWN0SURdID0gdGhpcztcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJPYmplY3QgXCIgKyBHYW1lSXRlbS5nYW1lSXRlbUlEICsgXCIgY3JlYXRlZC5cIik7XHJcbiAgICAgICAgICAgIEdhbWVJdGVtLmdhbWVJdGVtSUQgKys7XHJcbiAgICAgICAgfSBcclxuICAgICAgICBcclxuICAgICAgICBnZXRJdGVtKGlkOiBudW1iZXIpe1xyXG4gICAgICAgICAgICByZXR1cm4gR2FtZUl0ZW0uZ2FtZUl0ZW1zW2lkXTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBcclxuICAgIFxyXG4gICAgZXhwb3J0IGNsYXNzIEJveCBleHRlbmRzIEdhbWVJdGVte1xyXG4gICAgICAgIGdlb21ldHJ5O1xyXG4gICAgICAgIG1hdGVyaWFsO1xyXG4gICAgICAgIG1lc2g7XHJcbiAgICAgICAgY29uc3RydWN0b3IoKXtcclxuICAgICAgICAgICAgc3VwZXIoKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHRoaXMuZ2VvbWV0cnkgPSBuZXcgVEhSRUUuQm94R2VvbWV0cnkoIDEsIDEsIDEgKTs7XHJcbiAgICAgICAgICAgIHRoaXMubWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoIHsgY29sb3I6IDB4MDBmZjAwIH0gKTs7XHJcbiAgICAgICAgICAgIHRoaXMubWVzaCA9IG5ldyBUSFJFRS5NZXNoKHRoaXMuZ2VvbWV0cnksIHRoaXMubWF0ZXJpYWwgKTs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJvdGF0ZSh4PzpudW1iZXIsIHk/Om51bWJlciwgej86bnVtYmVyKXtcclxuICAgICAgICAgICAgaWYoeClcclxuICAgICAgICAgICAgICAgIHRoaXMubWVzaC5yb3RhdGlvbi54ICs9IHg7XHJcbiAgICAgICAgICAgIGlmKHkpXHJcbiAgICAgICAgICAgICAgICB0aGlzLm1lc2gucm90YXRpb24ueSArPSB5O1xyXG4gICAgICAgICAgICBpZih6KVxyXG4gICAgICAgICAgICAgICAgdGhpcy5tZXNoLnJvdGF0aW9uLnogKz0gejtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4vZGVmcy91bmRlcnNjb3JlL3VuZGVyc2NvcmUuZC50c1wiIC8+XHJcbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuL2RlZnMvanF1ZXJ5L2pxdWVyeS5kLnRzXCIgLz5cclxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4vZGVmcy90aHJlZS90aHJlZS5kLnRzXCIgLz5cclxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4vZ2FtZU9iamVjdHMudHNcIiAvPlxyXG5cclxuaW1wb3J0ICogYXMgJCBmcm9tIFwianF1ZXJ5XCI7XHJcbmltcG9ydCAqIGFzIF8gZnJvbSBcInVuZGVyc2NvcmVcIjtcclxuaW1wb3J0ICogYXMgVEhSRUUgZnJvbSBcInRocmVlXCI7XHJcbmltcG9ydCBDQU5OT04gPSByZXF1aXJlKFwiY2Fubm9uXCIpO1xyXG5cclxudmFyIGdhbWU7XHJcbiQoKCkgPT4ge1xyXG4gICAgY29uc29sZS5sb2coXCJqcXVlcnkgJiB1bmRlcnNjb3JlIGxvYWRlZFwiKTtcclxuXHJcbiAgICBjcmVhdGVHYW1lKCk7XHJcbn0pO1xyXG5cclxuXHJcblxyXG5mdW5jdGlvbiBjcmVhdGVHYW1lKCl7XHJcbiAgICBnYW1lID0gbmV3IEdhbWVPYmplY3RzLkdhbWUoQ0FOTk9OLCBUSFJFRSk7XHJcbiAgICB2YXIgc2NlbmUgPSBuZXcgR2FtZVNjZW5lcy5TY2VuZShUSFJFRSk7XHJcbiAgICB2YXIgYm94ID0gbmV3IEdhbWVPYmplY3RzLkJveCgpO1xyXG4gICAgXHJcbiAgICBzY2VuZS5hZGQoIGJveCApO1xyXG5cclxuICAgIHNjZW5lLnBvc2l0aW9uQ2FtZXJhKG51bGwsbnVsbCw1KTtcclxuICAgIFxyXG5cclxuICAgIHZhciByZW5kZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCByZW5kZXIgKTtcclxuICAgICAgICBcclxuICAgICAgICBib3gucm90YXRlKC4xLCBudWxsLCBudWxsKTtcclxuICAgICAgICBib3gucm90YXRlKG51bGwsLjEsbnVsbCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgZ2FtZS5yZW5kZXIoc2NlbmUpO1xyXG4gICAgfTtcclxuXHJcbiAgICByZW5kZXIoKTtcclxufVxyXG5cclxuIiwiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4vZGVmcy90aHJlZS90aHJlZS5kLnRzXCIgLz5cclxuXHJcbm1vZHVsZSBHYW1lU2NlbmVze1xyXG4gICAgXHJcbiAgICAvL2EgZ2FtZSBzY2VuZS4gIEl0IHdpbGwgaGF2ZSB0aGUgY2FtZXJhLCBsaWdodHMsIGFuZCBzY2VuZSBncmFwaFxyXG4gICAgZXhwb3J0IGNsYXNzIFNjZW5le1xyXG4gICAgICAgIG5hbWU6IHN0cmluZztcclxuICAgICAgICBzZXF1ZW5jZTogc3RyaW5nO1xyXG4gICAgICAgIGNhbWVyYTtcclxuICAgICAgICBsaWdodHMgPSBbXTtcclxuICAgICAgICBzdGF0aWMgc2NlbmVJRDogbnVtYmVyID0gMDtcclxuICAgICAgICBzdGF0aWMgc2NlbmVzID0gW107XHJcbiAgICAgICAgdGhyZWVTY2VuZTtcclxuICAgICAgICBUSFJFRTtcclxuICAgICAgICBcclxuICAgICAgICBjb25zdHJ1Y3RvcihUSFJFRSwgbmFtZT86IHN0cmluZyl7XHJcbiAgICAgICAgICAgIHRoaXMuVEhSRUUgPSBUSFJFRTtcclxuICAgICAgICAgICAgaWYobmFtZSl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB0aGlzLnRocmVlU2NlbmUgPSBuZXcgVEhSRUUuU2NlbmUoKTtcclxuICAgICAgICAgICAgdGhpcy5jYW1lcmEgPSBuZXcgVEhSRUUuUGVyc3BlY3RpdmVDYW1lcmEoIDc1LCB3aW5kb3cuaW5uZXJXaWR0aCAvIHdpbmRvdy5pbm5lckhlaWdodCwgMC4xLCAxMDAwICk7XHJcbiBcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJzY2VuZSBcIiArIFNjZW5lLnNjZW5lSUQgICsgXCIgY3JlYXRlZFwiKTtcclxuICAgICAgICAgICAgU2NlbmUuc2NlbmVzLnB1c2godGhpcyk7XHJcbiAgICAgICAgICAgIFNjZW5lLnNjZW5lSUQrKztcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgYWRkKGl0ZW0pe1xyXG4gICAgICAgICAgICB0aGlzLnRocmVlU2NlbmUuYWRkKGl0ZW0ubWVzaCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHBvc2l0aW9uQ2FtZXJhKHg/Om51bWJlciwgeT86bnVtYmVyLCB6PzpudW1iZXIpe1xyXG4gICAgICAgICAgICBpZih4KVxyXG4gICAgICAgICAgICAgICAgdGhpcy5jYW1lcmEucG9zaXRpb24ueCA9IHg7XHJcbiAgICAgICAgICAgIGlmKHkpXHJcbiAgICAgICAgICAgICAgICB0aGlzLmNhbWVyYS5wb3NpdGlvbi55ID0geTtcclxuICAgICAgICAgICAgaWYoeilcclxuICAgICAgICAgICAgICAgIHRoaXMuY2FtZXJhLnBvc2l0aW9uLnogPSB6O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG59XHJcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
